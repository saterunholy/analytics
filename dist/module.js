/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","app/core/core","@grafana/runtime"],(function(t,e,n,o,r){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=8)}([function(e,n){e.exports=t},function(t){t.exports=JSON.parse('{"endpoint":"http://localhost:8080/telegraf","hidden":false,"noCors":false,"postEnd":false,"flatten":true}')},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=o},function(t,e,n){var o=n(7);function r(t){return t}function i(t,e){const n=(e=e||{}).delimiter||".",i=e.maxDepth,a=e.transformKey||r,c={};return function t(r,u,s){s=s||1,Object.keys(r).forEach((function(l){const p=r[l],f=e.safe&&Array.isArray(p),d=Object.prototype.toString.call(p),y=o(p),h="[object Object]"===d||"[object Array]"===d,b=u?u+n+a(l):a(l);if(!f&&!y&&h&&Object.keys(p).length&&(!e.maxDepth||s<i))return t(p,b,s+1);c[b]=p}))}(t),c}t.exports=i,i.flatten=i,i.unflatten=function t(e,n){const a=(n=n||{}).delimiter||".",c=n.overwrite||!1,u=n.transformKey||r,s={};if(o(e)||"[object Object]"!==Object.prototype.toString.call(e))return e;function l(t){const e=Number(t);return isNaN(e)||-1!==t.indexOf(".")||n.object?t:e}return e=Object.keys(e).reduce((t,o)=>{const r=Object.prototype.toString.call(e[o]);return!("[object Object]"===r||"[object Array]"===r)||function(t){const e=Object.prototype.toString.call(t),n="[object Array]"===e,o="[object Object]"===e;if(!t)return!0;if(n)return!t.length;if(o)return!Object.keys(t).length}(e[o])?(t[o]=e[o],t):function(t,e,n){return Object.keys(n).reduce((function(e,o){return e[t+a+o]=n[o],e}),e)}(o,t,i(e[o],n))},{}),Object.keys(e).forEach((function(o){const r=o.split(a).map(u);let i=l(r.shift()),p=l(r[0]),f=s;for(;void 0!==p;){const t=Object.prototype.toString.call(f[i]),e="[object Object]"===t||"[object Array]"===t;if(!c&&!e&&void 0!==f[i])return;(c&&!e||!c&&null==f[i])&&(f[i]="number"!=typeof p||n.object?{}:[]),f=f[i],r.length>0&&(i=l(r.shift()),p=l(r[0]))}f[i]=t(e[o],n)})),s}},function(t,e){t.exports=r},function(t,e){t.exports=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},function(t,e,n){"use strict";n.r(e);var o=n(3),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var i=n(0),a=n.n(i),c=n(4);function u(t){try{new URL(t)}catch(t){return!1}return!0}function s(t){return t.replace(/^.+\/\//g,"").replace(/\/.+$/g,"")}function l(t){return t.replace(/^.+\/d\//g,"").replace(/\/.+$/g,"")}function p(t){return{name:(e=t,e.replace(/^.+\/d\/.+\//g,"").replace(/\?.+$/g,"")),uid:l(t)};var e}function f(){return Math.floor((new Date).getTime()/1e3)}function d(t){var e=t.status.toString();if(!/^(0)|(20[0-4])$/.test(e))throw new Error("Returned status "+e);return t}var y=n(5),h=n(2),b=n(6),O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={update:""},e.body=function(){var t=e.props.timeRange,n={from:t.from.unix(),to:t.to.unix()},o=window.location.href,r=s(o),i=Object(b.getTemplateSrv)().getVariables(),a=p(o),u=i.map((function(t){var e,n=t,o=null===(e=null==n?void 0:n.current)||void 0===e?void 0:e.value;return{name:t.name,label:t.label,type:t.type,value:o||null}})),l={host:{endpoint:r},timeRange:n,dashboard:a},d=e.props.options.analyticsOptions,h=c.contextSrv.user,O=f();return d.flatten?Object(y.flatten)({options:d,environment:l,context:h,time:O}):{options:d,environment:l,context:h,variables:u,time:O}},e.getRequestInit=function(){var t=e.props.options.analyticsOptions.noCors;return e.setState({error:void 0}),{method:"POST",mode:t?"no-cors":"cors",body:JSON.stringify(e.body()),headers:{"Content-Type":"application/json"}}},e.sendInitPayload=function(){var t=e.props.options.analyticsOptions,n=t.server,o=t.postEnd;if(u(n)){var r=fetch(n,e.getRequestInit());o?r.then((function(t){return d(t)})).then((function(t){return t.json()})).then((function(t){return e.setState({update:t.location})})).catch((function(t){e.setState({error:t})})):r.then((function(t){return d(t)})).catch((function(t){e.setState({error:t})}))}else{var i=new Error('"'+n+'" is not a valid URL');e.setState({error:i})}},e.sendFinPayload=function(){var t=e.props.options.analyticsOptions,n=t.server,o=t.postEnd,r=e.state.update;o&&r&&fetch(n+"/"+r,e.getRequestInit()).then((function(t){return d(t)}))},e}return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.componentDidMount=function(){this.sendInitPayload()},e.prototype.componentWillUnmount=function(){this.sendFinPayload()},e.prototype.render=function(){var t=this,e=this.props,n=e.width,o=e.height,r=this.props.options.analyticsOptions.hidden,i=this.state.error;if(i&&r)throw i;return a.a.createElement("div",{style:{position:"relative",overflow:"auto",width:n,height:o}},i&&a.a.createElement("div",{style:{display:"inline-block",textAlign:"center",width:"100%"}},a.a.createElement(h.ErrorWithStack,{title:"analytics-panel error",error:i,errorInfo:null}),a.a.createElement(h.Button,{onClick:function(){return t.sendInitPayload()}},"Retry")),!r&&a.a.createElement(h.JSONFormatter,{json:this.body()}))},e}(i.PureComponent),m=n(1);n.d(e,"plugin",(function(){return g}));var v=p(window.location.href),g=new o.PanelPlugin(O).setPanelOptions((function(t){t.addTextInput({path:"analyticsOptions.server",name:"Endpoint",defaultValue:m.endpoint,description:"Location to POST data on panel load."}).addTextInput({path:"analyticsOptions.key",name:"Dashboard ID",defaultValue:v.uid,description:"Unique value to identify the dashboard."}).addTextInput({path:"analyticsOptions.description",name:"Dashboard Description",defaultValue:v.name,description:"Description of the dashboard."}).addBooleanSwitch({path:"analyticsOptions.hidden",name:"Hide JSON",description:"Hides the printed JSON object on the panel.",defaultValue:m.hidden}).addBooleanSwitch({path:"analyticsOptions.noCors",name:"No CORS",description:"Sets request mode to no-cors.",defaultValue:m.noCors}).addBooleanSwitch({path:"analyticsOptions.postEnd",name:"Post End",description:"Sends a second request when the panel is unloaded. Disable if you are using Telegraf.",defaultValue:m.postEnd}).addBooleanSwitch({path:"analyticsOptions.flatten",name:"Flatten",description:"Flattens the payload JSON. Enable if you are using Telegraf.",defaultValue:m.flatten})}))}])}));
//# sourceMappingURL=module.js.map